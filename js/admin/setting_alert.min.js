jQuery( document ).ready(function( $ ) 
{
    var crm_list;
    var alert_list;

    var crm_id = -1;
    var type_id = -1;
    var receiver_id = -1;
    var receiver_action = '';

    var login_user_role = 0;

	var level_waiting = false;
    var receiver_waiting = false;

    //var spinner = '<p><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></p>';
    var spinner = '<img src="../images/loading.gif" style="width:22px;height:22;">';

	
	init();


	function init()
	{
		ajaxGetLoginUser();
	}

    function ajaxGetLoginUser() 
    {
        $.ajax(
        {
            type : 'GET',
            url : '../daemon/ajax/get_login_user.php',
            data : { },
            success:function(response)
            {
                var obj = jQuery.parseJSON(response);
                login_user_role = parseInt(obj[2]);

                ajaxAlertTypeList();
                //ajaxAlertReceiverList();
            },
            failure:function(response) 
            {
            }
        });
    }

    function show_alert(type, msg) 
    {
        if (type == 'level')
        {
            $('.setting_crm_alert').html(msg);
            $('.setting_crm_alert').fadeIn(1000, function () {
                $('.setting_crm_alert').fadeOut(3000);
            });
        }
        else if (type == 'level_edit')
        {
            $('.alert_edit_level').html(msg);
            $('.alert_edit_level').fadeIn(1000, function () {
                $('.alert_edit_level').fadeOut(3000);
            });
        }
        else if (type == 'receiver')
        {
            $('.setting_receiver_alert').html(msg);
            $('.setting_receiver_alert').fadeIn(1000, function () {
                $('.setting_receiver_alert').fadeOut(3000);
            });
        }
        else if (type == 'receiver_add')
        {
            $('.receiver_add_alert').html(msg);
            $('.receiver_add_alert').fadeIn(1000, function () {
                $('.receiver_add_alert').fadeOut(3000);
            });
        }
        else if (type == 'receiver_edit')
        {
            $('.receiver_edit_alert').html(msg);
            $('.receiver_edit_alert').fadeIn(1000, function () {
                $('.receiver_edit_alert').fadeOut(3000);
            });
        }
    }

    function show_waiting(type, show)
    {
        if (type == 'level')
        {
            level_waiting = show;

            if (level_waiting)
                $('.alert_level_waiting').html(spinner);
            else
                $('.alert_level_waiting').html('');
        }
        else if (type == 'receiver')
        {
            receiver_waiting = show;

            if (receiver_waiting)
                $('.alert_receiver_waiting').html(spinner);
            else
                $('.alert_receiver_waiting').html('');
        }
    }

    // edit alert level function
    $('.table_level_body').on('click', '.btn_level_edit', function (e)
    {
        crm_id = $(this).prop('id');

        var html = '';

        html += '<div class="alert alert-warning alert_edit_level" role="alert" style="display:none"></div>';
        
        html += '<div class="row" style="margin-bottom:5px;">';
        html += '<div class="col-md-6 modal_input_label">CRM Name</div>';
        html += '<div class="col-md-6"><input type="text" class="form-control input-sm edit_crm_name" readonly value="' + $('#name_' + crm_id).text() + '"></div>';
        html += '</div>';

        for (var i = 0; i < alert_list.length; i ++)
        {
            if (alert_list[i][10] == '1')
            {
                html += '<div class="row" style="margin-bottom:5px;">';
                html += '<div class="col-md-6 modal_input_label">' + alert_list[i][2] + '</div>';
                html += '<div class="col-md-6"><input type="text" class="form-control input-sm edit_level_' + alert_list[i][1] + '" value="' + ($('#level_' + alert_list[i][1] + '_' + crm_id).text()) + '"></div>';
                html += '</div>';
            }
        }

        $('.modal_level_body').html(html);
    });

    $('.modal_btn_level_edit').click(function ()
    {
        for (var i = 0; i < alert_list.length; i ++)
        {
            if (alert_list[i][10] == '1' && $('.edit_level_' + alert_list[i][1]).val() == '')
            {
                show_alert('level_edit', 'Please input Alert level.');
                $('.edit_level_' + alert_list[i][1]).focus();
                return;
            }
        }

        $('#level_edit_modal').modal('toggle');
        
        var rlength = 0;
        for (var i = 0; i < alert_list.length; i ++)
        {
            if (alert_list[i][10] == '1')
                rlength ++;
        }

        for (var i = 0; i < alert_list.length; i ++)
        {
            if (alert_list[i][10] == '1')
                ajaxAlertLevelEdit(alert_list[i][1], crm_id, $('.edit_level_' + alert_list[i][1]).val(), '0', (i == (rlength - 1)) ? true : false);
        }
    });

    // edit alert schedule
    $('.table_type_body').on('click', '.btn_type_edit', function (e)
    {
        type_id = $(this).prop('id');

        $('.edit_day').each( function(i) 
        {
            $(this).prop('checked', false);
        });

        $('.edit_hour').each( function(i) 
        {
            $(this).prop('checked', false);
        });

        $('.edit_receiver').each( function(i) 
        {
            $(this).prop('checked', false);
        });

        for (var i = 0; i < alert_list.length; i ++)
        {
            if (type_id == alert_list[i][1])
            {
                var days = alert_list[i][5].split(',');
                var hours = alert_list[i][6].split(',');
                var sms = alert_list[i][7];
                var email = alert_list[i][8];
                var bot = alert_list[i][9];

                for (var j = 0; j < days.length; j ++)
                    $('#day_' + days[j]).prop('checked', true);
                for (var k = 0; k < hours.length; k ++)
                    $('#hour_' + hours[k]).prop('checked', true);

                if (sms == '1')
                    $('#receiver_0').prop('checked', true);
                if (email == '1')
                    $('#receiver_1').prop('checked', true);
                if (bot == '1')
                    $('#receiver_2').prop('checked', true);

                return;
            }
        }
    });

    $('.modal_btn_type_edit').click(function ()
    {
        var days = ''; 
        $('.edit_day').each( function(i) 
        {
            if ($(this).prop('checked'))
            {
                if (days != '') days += ',';
                days += $(this).prop('id').substring(4);
            }
        });

        var hours = ''; 
        $('.edit_hour').each( function(i) 
        {
            if ($(this).prop('checked'))
            {
                if (hours != '') hours += ',';
                hours += $(this).prop('id').substring(5);
            }
        });

        var r_sms = $('#receiver_0').prop('checked') ? '1' : '0';
        var r_email = $('#receiver_1').prop('checked') ? '1' : '0';
        var r_bot = $('#receiver_2').prop('checked') ? '1' : '0';

        $('#type_edit_modal').modal('toggle');
        ajaxAlertScheduleEdit(type_id, days, hours, r_sms, r_email, r_bot);
    });

    // add SMS alert receiver
    $('.btn_receiver_sms_add').click(function ()
    {
        receiver_action = 'sms';

        $('.add_receiver_label').html('SMS Number');
        $('.add_receiver_name').val('');
        $('.add_receiver_chatid').val('');
        $('.add_receiver_state').prop('checked', false);

        $('#telegram_add_chatid').css('display', 'none');
    });

    $('.modal_btn_receiver_add').click(function ()
    {
        if (receiver_action == 'sms')
        {
            if ($('.add_receiver_name').val() == '')
            {
                show_alert('receiver_add', 'Please input SMS Number.');
                $('.add_receiver_name').focus();
                return;
            }

            ajaxAlertReceiverAdd(0);
        }
        else if (receiver_action == 'mail')
        {
            if ($('.add_receiver_name').val() == '')
            {
                show_alert('receiver_add', 'Please input Email Address.');
                $('.add_receiver_name').focus();
                return;
            }
            
            ajaxAlertReceiverAdd(1);
        }
        else if (receiver_action == 'bot')
        {
            if ($('.add_receiver_name').val() == '')
            {
                show_alert('receiver_add', 'Please input User Name.');
                $('.add_receiver_name').focus();
                return;
            }

            if ($('.add_receiver_chatid').val() == '')
            {
                show_alert('receiver_add', 'Please input Chat ID.');
                $('.add_receiver_chatid').focus();
                return;
            }
            
            ajaxAlertReceiverAdd(2);
        }

        $('#receiver_add_modal').modal('toggle');        
    });

    // edit SMS alert receiver
    $('.table_receiver_sms_body').on('click', '.btn_receiver_sms_edit', function (e)
    {
        receiver_action = 'sms';
        receiver_id = $(this).prop('id');

        $('.edit_receiver_label').html('SMS Number');
        $('.edit_receiver_name').val($('#name1_' + receiver_id).text());
        if ($('#stts1_' + receiver_id).text() == 'Disable')
            $('.edit_receiver_state').prop('checked', true);
        else
            $('.edit_receiver_state').prop('checked', false);

        $('.edit_receiver_chatid').val('');
        $('#telegram_edit_chatid').css('display', 'none');
    });

    $('.modal_btn_receiver_edit').click(function ()
    {
        if (receiver_action == 'sms')
        {
            if ($('.edit_receiver_name').val() == '')
            {
                show_alert('receiver_edit', 'Please input SMS Number.');
                $('.edit_receiver_name').focus();
                return;
            }

            ajaxAlertReceiverEdit(0);
        }
        else if (receiver_action == 'mail')
        {
            if ($('.edit_receiver_name').val() == '')
            {
                show_alert('receiver_edit', 'Please input Email Address.');
                $('.edit_receiver_name').focus();
                return;
            }

            ajaxAlertReceiverEdit(1);
        }
        else if (receiver_action == 'bot')
        {
            if ($('.edit_receiver_name').val() == '')
            {
                show_alert('receiver_edit', 'Please input User Name.');
                $('.edit_receiver_name').focus();
                return;
            }

            if ($('.edit_receiver_chatid').val() == '')
            {
                show_alert('receiver_edit', 'Please input Chat ID.');
                $('.edit_receiver_chatid').focus();
                return;
            }

            ajaxAlertReceiverEdit(2);
        }

        $('#receiver_edit_modal').modal('toggle');        
    });

    // delete SMS alert receiver
    $('.table_receiver_sms_body').on('click', '.btn_receiver_sms_delete', function (e)
    {
        receiver_action = 'sms';
        receiver_id = $(this).prop('id');
    });

    $('.modal_btn_receiver_delete').click(function ()
    {
        $('#receiver_delete_modal').modal('toggle');

        if (receiver_action == 'sms')
            ajaxAlertReceiverDelete(0);
        else if (receiver_action == 'mail')
            ajaxAlertReceiverDelete(1);
        else if (receiver_action == 'bot')
            ajaxAlertReceiverDelete(2);
    });

    // add Email alert receiver
    $('.btn_receiver_mail_add').click(function ()
    {
        receiver_action = 'mail';

        $('.add_receiver_label').html('Email Address');
        $('.add_receiver_name').val('');
        $('.add_receiver_state').prop('checked', false);

        $('.add_receiver_chatid').val('');
        $('#telegram_add_chatid').css('display', 'none');
    });

    // edit Email alert receiver
    $('.table_receiver_mail_body').on('click', '.btn_receiver_mail_edit', function (e)
    {
        receiver_action = 'mail';
        receiver_id = $(this).prop('id');

        $('.edit_receiver_label').html('Email Address');
        $('.edit_receiver_name').val($('#name2_' + receiver_id).text());
        if ($('#stts2_' + receiver_id).text() == 'Disable')
            $('.edit_receiver_state').prop('checked', true);
        else
            $('.edit_receiver_state').prop('checked', false);

        $('.edit_receiver_chatid').val('');
        $('#telegram_edit_chatid').css('display', 'none');
    });

    // delete Email alert receiver
    $('.table_receiver_mail_body').on('click', '.btn_receiver_mail_delete', function (e)
    {
        receiver_action = 'mail';
        receiver_id = $(this).prop('id');
    });

    // add Bot alert receiver
    $('.btn_receiver_bot_add').click(function ()
    {
        receiver_action = 'bot';

        $('.add_receiver_label').html('User Name');
        $('.add_receiver_name').val('');
        $('.add_receiver_state').prop('checked', false);

        $('.add_receiver_chatid').val('');
        $('#telegram_add_chatid').css('display', 'inherit');
    });

    // edit Bot receiver
    $('.table_receiver_bot_body').on('click', '.btn_receiver_bot_edit', function (e)
    {
        receiver_action = 'bot';
        receiver_id = $(this).prop('id');

        $('.edit_receiver_label').html('User Name');
        $('.edit_receiver_name').val($('#name3_' + receiver_id).text());
        if ($('#stts3_' + receiver_id).text() == 'Disable')
            $('.edit_receiver_state').prop('checked', true);
        else
            $('.edit_receiver_state').prop('checked', false);

        $('.edit_receiver_chatid').val($('#chatid3_' + receiver_id).text());
        $('#telegram_edit_chatid').css('display', 'inherit');
    });

    // delete Bot alert receiver
    $('.table_receiver_bot_body').on('click', '.btn_receiver_bot_delete', function (e)
    {
        receiver_action = 'bot';
        receiver_id = $(this).prop('id');
    });


    function ajaxCrmList() 
    {
        if (level_waiting) return;

        show_waiting('level', true);

        var head = '<tr><th>#</th><th style="width:120px">CRM Name</th>';
        for (var i = 0; i < alert_list.length; i ++)
        {
            if (alert_list[i][10] == '1')
                head += '<th>' + alert_list[i][2] + '</th>';
        }
        head += '<th>Action</th></tr>';

        $('.table_level_head').html(head);
        
        $.ajax(
        {
            type : 'GET',
            url : '../daemon/ajax/crm_list.php',
            data : { },
            success:function(response)
            {
                show_waiting('level', false);

                if (response == 'error')
                {
                    show_alert('level', 'Cannot load CRM list.');
                    return;
                }
                else
                {
                    crm_list = jQuery.parseJSON(response);
					var crm_count = crm_list.length;
                    var html = '';                  
                    
                    if (crm_count > 0)
                    {
                        for (var i = 0; i < crm_count; i ++)
                        {
                            html += '<tr><td>' + (i + 1) + '</td>';
                            html += '<td id="name_' + crm_list[i][0] + '">' + crm_list[i][1] + '</td>';
                            for (var j = 0; j < alert_list.length; j ++)
                            {
                                if (alert_list[j][10] == '1')
                                    html += '<td id="level_' + alert_list[j][1] + '_' + crm_list[i][0] + '"></td>';
                            }
                            html += '<td><button type="button" class="btn btn-link btn-sm btn_level_edit" id="' + crm_list[i][0] + '" data-toggle="modal" data-target="#level_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;Edit</button></td>';
                            html += '</tr>';   
                        }
                    } 
                    else
                        show_alert('level', 'There is no any crm data.');

                    $('.table_level_body').html(html);
                    
                    for (var i = 0; i < crm_count; i ++)
                    {
                        ajaxAlertLevelList(crm_list[i][0]);
                    }                    
                }
            },
            failure:function(response) 
            {
                show_waiting('level', false);
                show_alert('level', 'Cannot load CRM list.');
            }
        });
    }

    function ajaxAlertTypeList() 
    {
        $.ajax(
        {
            type : 'GET',
            url : '../daemon/ajax/setting_alert_type.php',
            data : { },
            success:function(response)
            {
                if (response == 'error')
                {
                    show_alert('level', 'Cannot load Alert Type list.');
                    return;
                }
                else
                {
                    alert_list = jQuery.parseJSON(response);
                    var html = '';                  
                    
                    for (var i = 0; i < alert_list.length; i ++)
                    {
                        html += '<tr>';
                        html += '<td>' + alert_list[i][1] + '</td>';
                        html += '<td>' + alert_list[i][2] + '</td>';
                        html += '<td>' + alert_list[i][3] + '</td>';
                        html += '<td>' + alert_list[i][4] + '</td>';

                        var schedule = '';
                        if (alert_list[i][5] != '')
                            schedule = alert_list[i][5];
                        if (alert_list[i][6] != '')
                        {
                            if (schedule != '')
                                schedule += ' ';
                            schedule += '(' + alert_list[i][6] + ' hour)';
                        }
                        if (alert_list[i][7] == '1')
                        {
                            if (schedule != '')
                                schedule += ', ';
                            schedule += 'SMS';
                        }
                        if (alert_list[i][8] == '1')
                        {
                            if (schedule != '')
                                schedule += ', ';
                            schedule += 'Email';
                        }
                        if (alert_list[i][9] == '1')
                        {
                            if (schedule != '')
                                schedule += ', ';
                            schedule += 'Telegram Bot';
                        }

                        html += '<td>' + schedule + '</td>';
                        html += '<td><button type="button" class="btn btn-link btn-sm btn_type_edit" id="' + alert_list[i][1] + '" data-toggle="modal" data-target="#type_edit_modal"><span class="glyphicon glyphicon-time" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Schedule</button></td>';
                        html += '</tr>';   
                    }
                
                    $('.table_type_body').html(html);

                    ajaxCrmList();
                }
            },
            failure:function(response) 
            {
                show_waiting('level', false);
                show_alert('level', 'Cannot load Alert Type list.');
            }
        });
    }

    function ajaxAlertLevelList(cid)
    {
        $.ajax(
        {
            type : 'GET',
            url : '../daemon/ajax/setting_alert_list.php',
            data : {
                'crm_id' : cid
            },
            success:function(response)
            {
                var obj = jQuery.parseJSON(response);

                if (obj[0] == 'error')
                {
                    show_alert('level', 'Cannot load alert level information.');
                    return;
                }
                else
                {
                    var level_count = obj[2].length;

                    for (var i = 0; i < level_count; i ++)
                        $('#level_' + obj[2][i][2] + '_' + obj[1]).html(obj[2][i][4]);
                }
            },
            failure:function(response) 
            {
                show_alert('level', 'Cannot load alert level information.');
            }
        });
    }

    function ajaxAlertLevelEdit(atype, cid, level1, level2, updated)
    {
        $.ajax(
        {
            type : 'GET',
            url : '../daemon/ajax/setting_alert_edit.php',
            data : {
                'type' : atype,
                'crm_id' : cid,
                'level1' : level1,
                'level2' : level2
            },
            success:function(response)
            {
                if (response == 'error')
                    show_alert('level', 'Alert level cannot be changed.');

                if (updated)
                    ajaxCrmList();
            },
            failure:function(response) 
            {
                show_alert('level', 'Alert level cannot be changed.');
            }
        });
    }

    function ajaxAlertScheduleEdit(atype, days, hours, sms, email, bot)
    {
        $.ajax(
        {
            type : 'GET',
            url : '../daemon/ajax/setting_schedule_edit.php',
            data : {
                'type' : atype,
                'days' : days,
                'hours' : hours,
                'sms' : sms,
                'email' : email,
                'bot' : bot
            },
            success:function(response)
            {
                if (response == 'error')
                    show_alert('level', 'Alert Schedule cannot be changed.');
                else
                    ajaxAlertTypeList();
            },
            failure:function(response) 
            {
                show_alert('level', 'Alert Schedule cannot be changed.');
            }
        });
    }

    function ajaxAlertReceiverList()
    {
        show_waiting('receiver', true);

        $.ajax(
        {
            type : 'GET',
            url : '../daemon/ajax/setting_receiver_list.php',
            data : { },
            success:function(response)
            {
                var obj = jQuery.parseJSON(response);

                show_waiting('receiver', false);

                if (obj[0] == 'error')
                {
                    show_alert('receiver', 'Cannot load alert receiver list.');
                    return;
                }
                else
                {
                    var recvs = obj[1];

                    var html1 = '';     // for sms
                    var html2 = '';     // for email
                    var html3 = '';     // for bot

                    var num1 = 0;     // for sms
                    var num2 = 0;     // for email
                    var num3 = 0;     // for bot
                    
                    for (var i = 0; i < recvs.length; i ++)
                    {
                        if (recvs[i][1] == '0')
                        {
                            num1 ++;

                            html1 += '<tr>';
                            html1 += '<td>' + num1 + '</td>';
                            html1 += '<td id="name1_' + recvs[i][0] + '" style="word-wrap:break-word;word-break:break-all;">' + recvs[i][2] + '</td>';
                            html1 += '<td id="stts1_' + recvs[i][0] + '">' + (recvs[i][3] == '1' ? 'Enable' : 'Disable') + '</td>';
                            if (login_user_role == 9)
                            {
                                html1 += '<td>';
                                html1 += '<button type="button" class="btn btn-link btn-sm btn_receiver_sms_edit" id="' + recvs[i][0] + '" data-toggle="modal" data-target="#receiver_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></button>';
                                html1 += '<button type="button" class="btn btn-link btn-sm btn_receiver_sms_delete" id="' + recvs[i][0] + '" data-toggle="modal" data-target="#receiver_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span></button>';
                                html1 += '</td>';
                            }
                            html1 += '</tr>';
                        }
                        else if (recvs[i][1] == '1')
                        {
                            num2 ++;

                            html2 += '<tr>';
                            html2 += '<td>' + num2 + '</td>';
                            html2 += '<td id="name2_' + recvs[i][0] + '" style="word-wrap:break-word;word-break:break-all;">' + recvs[i][2] + '</td>';
                            html2 += '<td id="stts2_' + recvs[i][0] + '">' + (recvs[i][3] == '1' ? 'Enable' : 'Disable') + '</td>';
                            if (login_user_role == 9)
                            {
                                html2 += '<td>';
                                html2 += '<button type="button" class="btn btn-link btn-sm btn_receiver_mail_edit" id="' + recvs[i][0] + '" data-toggle="modal" data-target="#receiver_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></button>';
                                html2 += '<button type="button" class="btn btn-link btn-sm btn_receiver_mail_delete" id="' + recvs[i][0] + '" data-toggle="modal" data-target="#receiver_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span></button>';
                                html2 += '</td>';
                            }
                            html2 += '</tr>';
                        }
                        else if (recvs[i][1] == '2')
                        {
                            num3 ++;

                            html3 += '<tr>';
                            html3 += '<td>' + num3 + '</td>';
                            html3 += '<td id="name3_' + recvs[i][0] + '" style="word-wrap:break-word;word-break:break-all;">' + recvs[i][2] + '</td>';
                            html3 += '<td id="chatid3_' + recvs[i][0] + '">' + recvs[i][4] + '</td>';
                            html3 += '<td id="stts3_' + recvs[i][0] + '">' + (recvs[i][3] == '1' ? 'Enable' : 'Disable') + '</td>';
                            if (login_user_role == 9)
                            {
                                html3 += '<td>';
                                html3 += '<button type="button" class="btn btn-link btn-sm btn_receiver_bot_edit" id="' + recvs[i][0] + '" data-toggle="modal" data-target="#receiver_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></button>';
                                html3 += '<button type="button" class="btn btn-link btn-sm btn_receiver_bot_delete" id="' + recvs[i][0] + '" data-toggle="modal" data-target="#receiver_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span></button>';
                                html3 += '</td>';
                            }
                            html3 += '</tr>';
                        }
                    }
                
                    $('.table_receiver_sms_body').html(html1);
                    $('.table_receiver_mail_body').html(html2);
                    $('.table_receiver_bot_body').html(html3);
                }
            },
            failure:function(response) 
            {
                show_waiting('account', false);
                show_alert('account', 'Cannot load account list.');

                return;
            }
        });
    }

    function ajaxAlertReceiverAdd(type)
    {
        show_waiting('receiver', true);

        var status = 1;

        if ($('.add_receiver_state').prop('checked'))
            status = 0;

        $.ajax(
        {
            type : 'GET',
            url : '../daemon/ajax/setting_receiver_add.php',
            data : {
                'type' : type, 
                'address' : $('.add_receiver_name').val(), 
                'chat_id' : $('.add_receiver_chatid').val(), 
                'status' : status
            },
            success:function(response)
            {                
                show_waiting('receiver', false);                

                if (response == 'success')
                    ajaxAlertReceiverList();
                else
                    show_alert('receiver', 'Alert receiver cannot be added.');
            },
            failure:function(response) 
            {
                show_waiting('receiver', false);                
                show_alert('receiver', 'Alert receiver cannot be added.');
            }
        });
    }

    function ajaxAlertReceiverEdit(type)
    {
        show_waiting('receiver', true);

        var status = 1;
        if ($('.edit_receiver_state').prop('checked'))
            status = 0;

        $.ajax(
        {
            type : 'GET',
            url : '../daemon/ajax/setting_receiver_edit.php',
            data : {
                'receiver_id' : receiver_id, 
                'type' : type, 
                'address' : $('.edit_receiver_name').val(), 
                'chat_id' : $('.edit_receiver_chatid').val(), 
                'status' : status
            },
            success:function(response)
            {
                show_waiting('receiver', false);

                if (response == 'success')
                    ajaxAlertReceiverList();
                else
                    show_alert('receiver', 'Alert receiver cannot be changed.');
            },
            failure:function(response) 
            {
                show_waiting('receiver', false);
                show_alert('receiver', 'Alert receiver cannot be changed.');
            }
        });
    }

    function ajaxAlertReceiverDelete(type)
    {
        show_waiting('receiver', true);

        $.ajax(
        {
            type : 'GET',
            url : '../daemon/ajax/setting_receiver_delete.php',
            data : {'receiver_id' : receiver_id},
            success:function(response)
            {                
                show_waiting('receiver', false);  

                if (response == 'success')
                    ajaxAlertReceiverList();
                else
                    show_alert('receiver', 'Alert receiver cannot be deleted.');
            },
            failure:function(response) 
            {             
                show_waiting('receiver', false);
                show_alert('receiver', 'Alert receiver cannot be deleted.');
            }
        });
    }
});