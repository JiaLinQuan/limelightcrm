jQuery(document).ready(function(a){function m(){n(),q(),s()}function n(){a(".crm_dropdown_list").length>0&&(b=a(".crm_dropdown_list").prop("id"))}function o(b,c){"campaign"==b?(a(".setting_campaign_alert").html(c),a(".setting_campaign_alert").fadeIn(1e3,function(){a(".setting_campaign_alert").fadeOut(3e3)})):"label"==b?(a(".setting_label_alert").html(c),a(".setting_label_alert").fadeIn(1e3,function(){a(".setting_label_alert").fadeOut(3e3)})):"label_add"==b?(a(".label_add_alert").html(c),a(".label_add_alert").fadeIn(1e3,function(){a(".label_add_alert").fadeOut(3e3)})):"label_edit"==b?(a(".label_edit_alert").html(c),a(".label_edit_alert").fadeIn(1e3,function(){a(".label_edit_alert").fadeOut(3e3)})):"action_edit"==b&&(a(".action_edit_alert").html(c),a(".action_edit_alert").fadeIn(1e3,function(){a(".action_edit_alert").fadeOut(3e3)}))}function p(b,c){"campaign"==b?(g=c,g?a(".setting_campaign_waiting").html(l):a(".setting_campaign_waiting").html("")):"label"==b&&(i=c,i?a(".setting_label_waiting").html(l):a(".setting_label_waiting").html(""))}function q(){g||b==-1||(p("campaign",!0),a.ajax({type:"GET",url:"../daemon/ajax/setting_campaign_list.php",data:{crm_id:b,campaign_ids:a(".search_campaign_ids").val(),page_number:c,items_page:d},success:function(b){if(p("campaign",!1),"error"==b)return void o("campaign","Cannot load campaign list.");var c=jQuery.parseJSON(b),d="";f=c.length;var e=c.ids.length;if(e>0)for(var g=0;g<e;g++)d+='<tr><td><input type="checkbox" id="campaign_'+c.ids[g]+'" class="campaign_item"></td>',d+="<td>"+c.ids[g]+"</td>",d+="<td>"+c.names[g]+"</td>",d+="<td>"+c.labels[g]+"</td></tr>";else o("campaign","There is no any campaign data.");a(".table_campaign_body").html(d),a(".campagin_select_all").prop("checked",!1),r()},failure:function(a){p("campaign",!1),o("campaign","Cannot load campaign list.")}}))}function r(){var b='<button type="button" class="btn btn-default btn-sm campaign_page" id="page_first">&lt;&lt;</button><button type="button" class="btn btn-default btn-sm campaign_page" id="page_prev">&lt;</button>',g='<button type="button" class="btn btn-default btn-sm campaign_page" id="page_next">&gt;</button><button type="button" class="btn btn-default btn-sm campaign_page" id="page_last">&gt;&gt;</button>',h="",i="";if(f>0){var j=Math.floor((c-1)/e),k=j*e+1,l=(j+1)*e;l*d>f&&(l=Math.floor(f/d),f%d>0&&l++);for(var m=k;m<=l;m++)h+=m==c?'<button type="button" class="btn btn-success btn-sm campaign_page" id="page_'+m+'">'+m+"</button>":'<button type="button" class="btn btn-default btn-sm campaign_page" id="page_'+m+'">'+m+"</button>";j>0&&(i+=b),i+=h,l*d<f&&(i+=g)}a(".campaign_pagination").html(i)}function s(){i||(p("label",!0),a.ajax({type:"GET",url:"../daemon/ajax/setting_campaign_label_list.php",data:{},success:function(b){if(p("label",!1),"error"==b)return void o("label","Cannot load label list.");var c=jQuery.parseJSON(b),d="";if(f=c.length,f>0)for(var e=0;e<f;e++)d+="<tr><td>"+(e+1)+"</td>",d+='<td id="lname_'+c[e][0]+'">'+c[e][1]+"</td>",d+='<td><button type="button" class="btn btn-link btn-sm setting_label_edit" id="ledit_'+c[e][0]+'" data-toggle="modal" data-target="#campaign_label_edit_modal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span>&nbsp;Edit</button>',d+='<button type="button" class="btn btn-link btn-sm setting_label_delete" id="ldelete_'+c[e][0]+'" data-toggle="modal" data-target="#campaign_label_delete_modal"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true" style="color: #ffa5a5"></span>&nbsp;Delete</button></td></tr>';else o("label","There is no any label list.");a(".table_label_body").html(d)},failure:function(a){p("label",!1),o("label","Cannot load label list.")}}))}function t(){g||(p("campaign",!0),a.ajax({type:"GET",url:"../daemon/ajax/setting_campaign_label_list.php",data:{},success:function(b){if(p("campaign",!1),"error"==b)return void o("campaign","Cannot load label list.");var c=jQuery.parseJSON(b),d="";if(f=c.length,f>0){for(var e=0;e<f;e++)d+='<tr><td><input type="checkbox" id="mlabel_'+c[e][0]+'" class="modal_label_item"></td>',d+="<td>"+c[e][0]+"</td>",d+="<td>"+c[e][1]+"</td></tr>";a(".modal_label_body").html(d),a("#campaign_action_edit_modal").modal("toggle")}else o("campaign","There is no any label list.")},failure:function(a){p("campaign",!1),o("campaign","Cannot load label list.")}}))}function u(){p("label",!0),a.ajax({type:"GET",url:"../daemon/ajax/setting_campaign_label_add.php",data:{label_name:a(".add_label_name").val()},success:function(a){p("label",!1),"success"==a?s():o("label","Campaign label cannot be added.")},failure:function(a){p("label",!1),o("label","Campaign label cannot be added.")}})}function v(){p("label",!0),a.ajax({type:"GET",url:"../daemon/ajax/setting_campaign_label_edit.php",data:{label_id:h,label_name:a(".edit_label_name").val()},success:function(a){p("label",!1),"success"==a?s():o("label","Campaign label cannot be changed.")},failure:function(a){p("label",!1),o("label","Campaign label cannot be changed.")}})}function w(){p("label",!0),a.ajax({type:"GET",url:"../daemon/ajax/setting_campaign_label_delete.php",data:{label_id:h},success:function(a){p("label",!1),"success"==a?s():o("label","Campaign label cannot be deleted.")},failure:function(a){p("label",!1),o("label","Campaign label cannot be deleted.")}})}function x(){var b="";return a(".campaign_item").each(function(c){a(this).prop("checked")&&(""!=b&&(b+=","),b+=a(this).prop("id").substring(9))}),b}function y(){p("campaign",!0),a.ajax({type:"GET",url:"../daemon/ajax/setting_campaign_action_edit.php",data:{crm_id:b,campaign_ids:j,label_dis:k},success:function(a){p("campaign",!1),"success"==a?q():o("campaign","Campaign label cannot be changed.")},failure:function(a){p("campaign",!1),o("campaign","Campaign label cannot be changed.")}})}function z(){p("campaign",!0),a.ajax({type:"GET",url:"../daemon/ajax/setting_campaign_action_delete.php",data:{crm_id:b,campaign_ids:j},success:function(a){p("campaign",!1),"success"==a?q():o("campaign","Campaign label cannot be deleted.")},failure:function(a){p("campaign",!1),o("campaign","Campaign label cannot be deleted.")}})}var b=-1,c=1,d=10,e=7,f=0,g=!1,h=-1,i=!1,j="",k="",l='<img src="../images/loading.gif" style="width:22px;height:22;">';m(),a(".campagin_select_all").click(function(){a(".campaign_item").each(function(b){a(".campagin_select_all").prop("checked")?a(this).prop("checked",!0):a(this).prop("checked",!1)})}),a(".crm_dropdown_menu li").on("click",function(c){var d=a(this).text();b=a(this).find("a").attr("id"),a(".crm_toggle_button").html(d+' <span class="caret"></span>')}),a(".campaign_action_dropdown_menu li").on("click",function(b){var c=a(this).find("a").attr("id");return j=x(),""==j?void o("campaign","Please select campaign items."):void("action_edit"==c?t():"action_delete"==c&&a("#campaign_action_delete_modal").modal("toggle"))}),a(".modal_btn_action_edit").click(function(){return k="",a(".modal_label_item").each(function(b){a(this).prop("checked")&&(""!=k&&(k+=","),k+=a(this).prop("id").substring(7))}),""==k?void o("action_edit","Please select label item."):(a("#campaign_action_edit_modal").modal("toggle"),void y())}),a(".modal_btn_action_delete").click(function(){a("#campaign_action_delete_modal").modal("toggle"),z()}),a(".count_dropdown_menu li").on("click",function(b){d=a(this).text(),a(".count_toggle_button").html(d+' <span class="caret"></span>'),c=1,q()}),a(".campaign_search_button").click(function(){c=1,q()}),a(".campaign_pagination").on("click",".campaign_page",function(b){var g=a(this).prop("id").substring(5),h=Math.floor((c-1)/e);"first"==g?c=1:"prev"==g?c=(h-1)*e+1:"next"==g?c=(h+1)*e+1:"last"==g?(c=Math.floor(f/d),f%d>0&&c++):c=g,q()}),a(".btn_label_add").click(function(){a(".add_label_name").val("")}),a(".modal_btn_label_add").click(function(){return""==a(".add_label_name").val()?(o("label_add","Please input Label Name."),void a(".add_label_name").focus()):(a("#campaign_label_add_modal").modal("toggle"),void u())}),a(".table_label_body").on("click",".setting_label_edit",function(b){h=a(this).prop("id").substring(6),a(".edit_label_name").val(a("#lname_"+h).text())}),a(".modal_btn_label_edit").click(function(){return""==a(".edit_label_name").val()?(o("label_edit","Please input Label Name."),void a(".edit_label_name").focus()):(a("#campaign_label_edit_modal").modal("toggle"),void v())}),a(".table_label_body").on("click",".setting_label_delete",function(b){h=a(this).prop("id").substring(8)}),a(".modal_btn_label_delete").click(function(){a("#campaign_label_delete_modal").modal("toggle"),w()})});